# AI-INSIGHT 기능요구서 (PRD)
## 해수담수화 설비 예지보전 시스템

### 문서 정보
- **작성일**: 2024-01-15
- **버전**: 1.0
- **대상**: 오퍼레이터, 개발팀, 운영팀
- **목적**: 해수담수화 설비의 예지운전, 예지보수, 고장진단을 위한 AI 인사이트 시스템 구축

---

## 1. 제품 개요

### 1.1 비전
해수담수화 설비 운영의 신뢰성과 효율성을 극대화하는 AI 기반 예지보전 시스템

### 1.2 핵심 가치
1. **예지운전**: 가동범위 이탈 예측 및 사전 대응
2. **예지보수**: RO 멤브레인 등 핵심 부품 교체 시기 최적화
3. **고장진단**: 펌프 고장, 막파손, 수질사고 조기 감지

### 1.3 주요 사용자
- **1차 사용자**: 오퍼레이터 (24시간 교대 근무)
- **2차 사용자**: 정비팀, 관리자

---

## 2. 핵심 문제 정의

### 2.1 현재 문제점
| 문제 | 설명 | 영향도 |
|------|------|--------|
| RAG 응답 신뢰성 | DB 데이터 기반이 아닌 할루시네이션 발생 | 치명적 |
| 디버깅 불가 | AI 판단 근거와 과정을 알 수 없음 | 높음 |
| 형식적 응답 | 예측 불가능한 일정 패턴 응답 | 중간 |

### 2.2 해결 목표
- **신뢰성**: 오답률 측정 가능 및 90% 이상 정확도
- **투명성**: 6하 원칙(What/Why/How) 기반 구조화된 응답
- **실시간성**: 5초 이내 응답

---

## 3. 기능 요구사항

### 3.1 RAG 신뢰성 개선 (우선순위: 긴급)

#### 3.1.1 6하 원칙 기반 응답 체계
```
모든 AI 응답은 다음 구조를 따름:
- What (무엇): 현재 상태, 측정값, 이벤트
- Why (왜): 원인 분석, 상관관계
- How (어떻게): 해결 방법, 조치 사항
- When (언제): 발생 시간, 예측 시간
- Where (어디): 센서 위치, 영향 범위  
- Who (누가): 담당팀, 에스컬레이션
```

#### 3.1.2 응답 검증 시스템
- **데이터 출처 표시**: 사용된 센서, 시간, 값
- **계산 과정 공개**: 적용된 알고리즘, 임계값
- **신뢰도 점수**: 각 응답에 0-100% 신뢰도 표시

#### 3.1.3 오답 추적 시스템
- **Ground Truth 비교**: 실제 값 vs AI 예측 값
- **오답 패턴 분석**: 오답 발생 조건 자동 기록
- **피드백 루프**: 오퍼레이터 검증 결과 반영

### 3.2 예지운전 기능

#### 3.2.1 가동범위 모니터링
```python
감시 항목:
- TMP (Transmembrane Pressure): 정상 1-3 bar
- 차압 (Differential Pressure): 정상 0.5-1.5 bar  
- 전도도 (Conductivity): < 500 μS/cm
- 유량: 설계값의 ±10%
```

#### 3.2.2 예측 모델
- **예측 기간**: 10분, 30분, 1시간
- **예측 항목**: 
  - 임계값 초과 확률
  - 예상 도달 시간
  - 위험도 레벨 (정상/주의/경고/긴급)

#### 3.2.3 알람 시나리오
| 레벨 | 조건 | 대응 시간 | 조치 |
|------|------|-----------|------|
| 긴급 | 수질 기준 초과 | 즉시 | Emergency Stop |
| 경고 | 압력/유량 이상 | 5분 | 운전 조정 |
| 주의 | 트렌드 이상 | 30분 | 모니터링 강화 |

### 3.3 예지보수 기능

#### 3.3.1 RO 멤브레인 수명 예측
```
예측 모델 입력:
- 운전 시간 누적
- CIP 세척 횟수
- 평균 TMP 증가율
- 염제거율 감소 추세

출력:
- 잔여 수명 (일)
- 교체 권장 시기
- 신뢰도 %
```

#### 3.3.2 정비 스케줄 최적화
- **운전 스케줄 연동**: 생산 영향 최소화
- **부품 리드타임 고려**: 3개월 전 사전 알림
- **정비 이력 관리**: 부품별 교체 주기 학습

### 3.4 고장진단 기능

#### 3.4.1 고장 유형별 진단 로직

**펌프 고장 진단**
```
증상: 유출 수량 감소
확인 항목:
- 펌프 전류값 상승
- 진동 증가
- 효율 저하
```

**막파손 진단**
```
증상: 수질 이상
확인 항목:
- 전도도 급상승
- 탁도 증가
- 염제거율 급감
```

**막오염 진단**
```
증상: 압력 상승
확인 항목:
- TMP 지속 상승
- 유량 감소
- CIP 후 회복률 저하
```

#### 3.4.2 조기 경보 시스템
- **전조 증상 감지**: 정상 패턴 대비 편차 분석
- **복합 지표 모니터링**: 단일 센서가 아닌 조합 분석
- **트렌드 기반 예측**: 변화율 분석

### 3.5 수질 관리 기능

#### 3.5.1 먹는물 수질 기준 모니터링
- **실시간 항목**: pH, 탁도, 잔류염소, 전도도
- **주기 분석 항목**: 중금속, 미생물, 유기물
- **자동 차단**: AI 기반 임계값 학습 및 제안

#### 3.5.2 수질 보고서 생성
- **일일 보고서**: 24시간 트렌드, 이상 이벤트
- **주간 보고서**: 평균값, 최대/최소값, 준수율
- **월간 보고서**: 법규 준수 현황, 개선 추이

---

## 4. 비기능 요구사항

### 4.1 성능
- **응답 시간**: 5초 이내
- **동시 사용자**: 2명
- **데이터 처리**: 5-10초 주기 실시간
- **저장 용량**: 1MB/일

### 4.2 신뢰성
- **정확도**: 90% 이상
- **가용성**: 99.9%
- **데이터 보존**: 1년

### 4.3 사용성
- **언어**: 한국어 100%
- **인터페이스**: 텍스트, 차트, 알람, 대시보드
- **접근성**: 웹앱 (모바일 대응)

### 4.4 보안
- **인증**: 사용자별 권한 관리
- **감사**: 모든 조작 이력 기록
- **데이터**: 암호화 전송 및 저장

---

## 5. 시스템 아키텍처

### 5.1 데이터 소스
```
TimescaleDB (수처리 설비)
├── 실시간 센서 데이터 (5-10초)
├── 이력 데이터
└── QC 규칙

TimescaleDB (디지털트윈)
├── 시뮬레이션 데이터
└── 예측 모델 결과
```

### 5.2 AI 엔진 구성
```
Multi-Agent System
├── ResearchAgent: 데이터 수집
├── AnalysisAgent: 패턴 분석
├── ReviewAgent: 품질 검증
└── ResponseFormatter: 6하 원칙 포맷팅

RAG System
├── Knowledge Base: JSON 기반 지식
├── Semantic Search: 의미 검색
└── Response Validator: 할루시네이션 방지
```

### 5.3 통합 인터페이스
```
Reflex Framework
├── 실시간 대시보드
├── 챗봇 인터페이스
├── 알람 관리
└── 보고서 생성
```

---

## 6. 구현 로드맵

### Phase 1: 신뢰성 확보 (즉시)
- [ ] 6하 원칙 응답 포맷터 구현
- [ ] 응답 검증 시스템 구축
- [ ] 오답 추적 대시보드 개발

### Phase 2: 핵심 기능 (1개월)
- [ ] 예지운전 알고리즘 개발
- [ ] 고장진단 룰 엔진 구축
- [ ] 수질 모니터링 시스템

### Phase 3: 고도화 (2개월)
- [ ] 예지보수 ML 모델 훈련
- [ ] 외부 시스템 연동 (날씨, 전력)
- [ ] SCADA/DCS 인터페이스

---

## 7. 성공 지표 (KPI)

### 7.1 단기 지표 (1개월)
- RAG 응답 정확도 > 90%
- 할루시네이션 발생률 < 5%
- 평균 응답 시간 < 5초

### 7.2 중기 지표 (3개월)
- 고장 조기 감지율 > 80%
- 오경보율 < 10%
- 오퍼레이터 만족도 > 4.0/5.0

### 7.3 장기 지표 (6개월)
- 비계획 정지 시간 30% 감소
- RO 멤브레인 수명 10% 연장
- 수질 사고 Zero

---

## 8. 리스크 및 대응 방안

| 리스크 | 영향도 | 대응 방안 |
|--------|--------|-----------|
| 센서 데이터 품질 | 높음 | 이상치 필터링, 교차 검증 |
| AI 모델 성능 저하 | 중간 | 지속적 재학습, A/B 테스트 |
| 오퍼레이터 수용성 | 중간 | 단계적 도입, 교육 프로그램 |

---

## 9. 부록

### 9.1 용어 정의
- **TMP**: Transmembrane Pressure (막간 압력차)
- **CIP**: Clean-In-Place (제자리 세척)
- **RO**: Reverse Osmosis (역삼투)
- **SCADA**: Supervisory Control and Data Acquisition

### 9.2 참조 문서
- 먹는물 수질 기준 (환경부)
- 해수담수화 설비 운영 매뉴얼
- TimescaleDB API 문서